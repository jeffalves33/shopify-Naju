<section class="naju-cart">
  <div class="container">
    <div class="naju-cart__head">
      <h1 class="naju-cart__title">Seu Carrinho</h1>
      {% if cart.item_count > 0 %}
        <p class="naju-cart__count">
          {{ cart.item_count }}
          {% if cart.item_count == 1 %}item{% else %}itens{% endif %}
        </p>
      {% endif %}
    </div>

    {% if cart.item_count == 0 %}
      <!-- CARRINHO VAZIO -->
      <div class="naju-empty-state">
        <svg
          class="naju-empty-state__icon"
          width="64"
          height="64"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="1.5"
        >
          <circle cx="9" cy="21" r="1"/>
          <circle cx="20" cy="21" r="1"/>
          <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/>
        </svg>
        <h2 class="naju-empty-state__title">Carrinho vazio</h2>
        <p class="naju-empty-state__desc">Você ainda não adicionou produtos ao carrinho.</p>
        <a href="/collections/all" class="naju-btn-primary" style="margin-top: 20px;">Ver produtos</a>
      </div>

    {% else %}
      <!-- CARRINHO COM ITENS -->
      <div class="naju-cart__grid">
        <!-- LISTA DE PRODUTOS -->
        <div class="naju-cart__items">
          <form action="{{ routes.cart_url }}" method="post" id="cart-form">
            {% for item in cart.items %}
              <div class="naju-cart-item">
                <a href="{{ item.url }}" class="naju-cart-item__image">
                  {% if item.image %}
                    <img src="{{ item.image | image_url: width: 200 }}" alt="{{ item.title | escape }}">
                  {% else %}
                    <div class="naju-card__placeholder">
                      <svg
                        width="32"
                        height="32"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="1.5"
                      >
                        <rect x="3" y="3" width="18" height="18" rx="2"/>
                        <circle cx="8.5" cy="8.5" r="1.5"/>
                        <path d="m21 15-5-5L5 21"/>
                      </svg>
                    </div>
                  {% endif %}
                </a>

                <div class="naju-cart-item__info">
                  <a href="{{ item.url }}" class="naju-cart-item__title">{{ item.product.title }}</a>

                  {% if item.variant.title != 'Default Title' %}
                    <div class="naju-cart-item__variant">{{ item.variant.title }}</div>
                  {% endif %}

                  <div class="naju-cart-item__price">
                    {{ item.final_line_price | money }}
                    {% if item.original_line_price > item.final_line_price %}
                      <span class="naju-cart-item__compare">{{ item.original_line_price | money }}</span>
                    {% endif %}
                  </div>
                </div>

                <div class="naju-cart-item__qty">
                  <div class="naju-qty">
                    <button type="button" class="naju-qty__btn" onclick="updateQty(this, -1)" aria-label="Diminuir">
                      −
                    </button>
                    <input
                      type="number"
                      name="updates[]"
                      value="{{ item.quantity }}"
                      min="0"
                      class="naju-qty__input"
                      data-line="{{ forloop.index }}"
                    >
                    <button type="button" class="naju-qty__btn" onclick="updateQty(this, 1)" aria-label="Aumentar">
                      +
                    </button>
                  </div>
                </div>

                <a href="{{ item.url_to_remove }}" class="naju-cart-item__remove" aria-label="Remover item">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="3 6 5 6 21 6"/>
                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                  </svg>
                </a>
              </div>
            {% endfor %}

            <button type="submit" name="update" class="naju-btn-update">Atualizar carrinho</button>
          </form>
        </div>

        <!-- RESUMO DO PEDIDO -->
        <div class="naju-cart__summary">
          <div class="naju-summary">
            <h3 class="naju-summary__title">Resumo do pedido</h3>

            <div class="naju-summary__line">
              <span>Subtotal</span>
              <span class="naju-summary__value">{{ cart.total_price | money }}</span>
            </div>

            {% if cart.total_discount > 0 %}
              <div class="naju-summary__line naju-summary__line--discount">
                <span>Desconto</span>
                <span class="naju-summary__value">-{{ cart.total_discount | money }}</span>
              </div>
            {% endif %}

            <div class="naju-summary__note">Frete e impostos calculados no checkout</div>

            <div class="naju-summary__total">
              <span>Total</span>
              <span class="naju-summary__total-value">{{ cart.total_price | money }}</span>
            </div>

            <button
              type="submit"
              name="checkout"
              class="naju-btn-checkout"
              onclick="document.getElementById('cart-form').submit()"
            >
              Finalizar compra
            </button>

            <a href="/collections/all" class="naju-link-continue">← Continuar comprando</a>
          </div>
        </div>
      </div>
    {% endif %}
  </div>
</section>

<script>
  function updateQty(btn, change) {
    const input = btn.parentElement.querySelector('.naju-qty__input');
    const currentVal = parseInt(input.value) || 1;
    const newVal = Math.max(0, currentVal + change);
    input.value = newVal;

    if (newVal === 0) {
      if (confirm('Remover este item do carrinho?')) {
        document.getElementById('cart-form').submit();
      } else {
        input.value = 1;
      }
    }
  }
</script>

{% schema %}
{
  "name": "Cart",
  "settings": []
}
{% endschema %}
