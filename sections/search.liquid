<section class="naju-search">
  <div class="container">
    <!-- CABEÇALHO DA BUSCA -->
    <div class="naju-search__head">
      <h1 class="naju-search__title">
        {% if search.performed %}
          Resultados da busca
        {% else %}
          Buscar produtos
        {% endif %}
      </h1>

      <form action="{{ routes.search_url }}" method="get" role="search" class="naju-search__form">
        <div class="naju-search__input-wrap">
          <svg
            class="naju-search__icon"
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <circle cx="11" cy="11" r="8"/>
            <path d="m21 21-4.35-4.35"/>
          </svg>
          <input
            type="search"
            name="q"
            value="{{ search.terms | escape }}"
            placeholder="Buscar iPhone, capinha, fone..."
            class="naju-search__input"
            autocomplete="off"
          >
          <button type="submit" class="naju-search__btn">Buscar</button>
        </div>
      </form>
    </div>

    <!-- RESULTADOS -->
    {% if search.performed %}
      {% if search.results_count == 0 %}
        <div class="naju-empty-state">
          <svg
            class="naju-empty-state__icon"
            width="64"
            height="64"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="1.5"
          >
            <circle cx="11" cy="11" r="8"/>
            <path d="m21 21-4.35-4.35"/>
            <line x1="11" y1="8" x2="11" y2="14"/>
            <line x1="8" y1="11" x2="14" y2="11"/>
          </svg>
          <h2 class="naju-empty-state__title">Nenhum resultado encontrado</h2>
          <p class="naju-empty-state__desc">
            Não encontramos resultados para <strong>"{{ search.terms }}"</strong>
          </p>
          <p class="naju-empty-state__hint">Tente usar palavras-chave diferentes ou navegue pelas categorias.</p>
        </div>

      {% else %}
        <div class="naju-search__meta">
          <p class="naju-search__count">
            {% if search.results_count == 1 %}
              <strong>1</strong> produto encontrado
            {% else %}
              <strong>{{ search.results_count }}</strong> produtos encontrados
            {% endif %}
            {% if search.terms != blank %}
              para <strong>"{{ search.terms }}"</strong>
            {% endif %}
          </p>
        </div>

        {% paginate search.results by 20 %}
          <div class="naju-grid">
            {% for result in search.results %}
              {% if result.object_type == 'product' %}
                <a class="naju-pcard" href="{{ result.url }}">
                  <div class="naju-pcard__media">
                    {% if result.featured_image %}
                      <img
                        src="{{ result.featured_image | image_url: width: 900 }}"
                        alt="{{ result.title | escape }}"
                        loading="lazy"
                      >
                    {% else %}
                      <div class="naju-card__placeholder">
                        <svg
                          width="48"
                          height="48"
                          viewBox="0 0 24 24"
                          fill="none"
                          stroke="currentColor"
                          stroke-width="1.5"
                        >
                          <rect x="3" y="3" width="18" height="18" rx="2"/>
                          <circle cx="8.5" cy="8.5" r="1.5"/>
                          <path d="m21 15-5-5L5 21"/>
                        </svg>
                      </div>
                    {% endif %}

                    {% if result.compare_at_price > result.price %}
                      <span class="naju-badge">Oferta</span>
                    {% endif %}
                  </div>

                  <div class="naju-pcard__body">
                    <div class="naju-pcard__title">{{ result.title }}</div>

                    <div class="naju-pcard__price">
                      {{ result.price | money }}
                      {% if result.compare_at_price > result.price %}
                        <span class="naju-pcard__compare">{{ result.compare_at_price | money }}</span>
                      {% endif %}
                    </div>
                  </div>
                </a>

              {% elsif result.object_type == 'article' or result.object_type == 'page' %}
                <a class="naju-result-other" href="{{ result.url }}">
                  <div class="naju-result-other__icon">
                    {% if result.object_type == 'article' %}
                      <svg
                        width="20"
                        height="20"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                      >
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                        <polyline points="14 2 14 8 20 8"/>
                      </svg>
                    {% else %}
                      <svg
                        width="20"
                        height="20"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                      >
                        <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"/>
                        <polyline points="13 2 13 9 20 9"/>
                      </svg>
                    {% endif %}
                  </div>
                  <div>
                    <div class="naju-result-other__title">{{ result.title }}</div>
                    <div class="naju-result-other__type">
                      {% if result.object_type == 'article' %}Artigo{% else %}Página{% endif %}
                    </div>
                  </div>
                </a>
              {% endif %}
            {% endfor %}
          </div>

          {% if paginate.pages > 1 %}
            <nav class="naju-pagination" role="navigation" aria-label="Paginação">
              {% if paginate.previous %}
                <a class="naju-page" href="{{ paginate.previous.url }}">← Anterior</a>
              {% endif %}

              <span class="naju-page naju-page--info">
                Página {{ paginate.current_page }} de {{ paginate.pages }}
              </span>

              {% if paginate.next %}
                <a class="naju-page" href="{{ paginate.next.url }}">Próxima →</a>
              {% endif %}
            </nav>
          {% endif %}
        {% endpaginate %}
      {% endif %}

    {% else %}
      <!-- ESTADO INICIAL (antes de buscar) -->
      <div class="naju-search__suggestions">
        <h3 class="naju-search__suggestions-title">Categorias populares</h3>
        <div class="naju-search__tags">
          <a href="/collections/iphone" class="naju-tag">iPhone</a>
          <a href="/collections/android" class="naju-tag">Android</a>
          <a href="/collections/acessorios" class="naju-tag">Acessórios</a>
          <a href="/collections/fones" class="naju-tag">Fones</a>
          <a href="/collections/carregadores" class="naju-tag">Carregadores</a>
        </div>
      </div>
    {% endif %}
  </div>
</section>

{% schema %}
{
  "name": "Search",
  "settings": []
}
{% endschema %}
